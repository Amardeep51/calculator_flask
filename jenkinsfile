pipeline {
    agent any

    stages {        
        stage('Compiling Stage'){
            steps{
                bat 'python calculator.py'
                echo "Compilation done successfully!"
            }
        }
        stage('Testing Stage'){
            steps{
                bat 'python test_calculator.py'
                echo "Unit Test done successfully!"
            }
        }

        stage('Final Confirmation'){
                    steps{
                        bat 'python run_tests.py'
                        echo "That is the result of testing"
                    }
                }

        stage('Building Docker Image'){
            steps{
                bat 'docker image build -t calculator_flask .'
                echo "Image Built Successfully"
            }
        }

        stage('Stop previous containers') {
                    steps {
                        sh 'docker ps -f name=calculator_flask -q | xargs --no-run-if-empty docker container stop'
                        sh 'docker container ls -a -fname=calculator_flask -q | xargs -r docker container rm'
                    }
                }

        stage('Running Docker Image'){
              steps{
                   bat 'docker run -p 5000:5000 -d calculator_flask'
                   echo "Image Running"
              }
        }
    }
}
